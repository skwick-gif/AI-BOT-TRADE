# ML Training & Pipeline — מדריך מלא (2025)

## מבוא
הלשונית ML (Machine Learning) מאפשרת אימון מודלים מתקדמים לחיזוי מגמות בשוק ההון, תוך שימוש בנתוני היסטוריה מקיפים של למעלה מ-10,000 מניות אמריקאיות.

## מבנה הלשונית

הלשונית מחולקת ל-3 טאבים עיקריים:

### 💾 Data — ניהול נתונים
**מטרה:** טעינה וניהול נתוני המסחר ההיסטוריים

**תת-טאבים:**
- **📥 Data Loading:** בחירת מקור נתונים וטעינת נתונים בסיסיים
- **🗓️ Daily Update:** תזמון והרצת עדכונים יומיים אוטומטיים

#### Data Loading
**תכונות:**
- בחירת מקור נתונים: IBKR, Yahoo Finance, Alpha Vantage, או קובץ CSV מותאם
- בחירת טווח תאריכים: חודש, 3 חודשים, שנה, 2 שנים, 5 שנים
- הזנת רשימת מניות (מופרדת בפסיקים)
- טעינת נתונים עם התקדמות חזותית
- ייצוא נתונים מעובדים

#### Daily Update
**תכונות:**
- **Schedule Configuration:** הגדרת זמן הרצה יומי (ברירת מחדל: 01:30)
- **Batch Limit:** הגבלת מספר המניות לעדכון (0 = כל המניות)
- **Run Now:** הרצת עדכון מיידי עם התקדמות חזותית
- **Stop:** עצירת עדכון פעיל
- **Save Schedule:** שמירת הגדרות התזמון
- **Final Report:** דוח סיכום מפורט לאחר השלמת העדכון
- **Live Logs:** לוגים בזמן אמת של תהליך העדכון

**נתונים זמינים:**
- 10,958 מניות אמריקאיות
- טווח זמן: 2020-2025 (כ-6 שנים)
- ממוצע 1,044 שורות נתונים למניה
- סה"כ: 11.4 מיליון שורות נתונים

### 🚀 Pipeline — אימון והרצת מודלים
**מטרה:** הגדרת פרמטרי האימון והרצת תהליך הלמידה המכונה

#### הגדרות תצורה (Pipeline Configuration)
- **Holdout days (ימי בדיקה):** מספר הימים האחרונים שישמשו לבדיקת ביצועי המודל (ברירת מחדל: 30)
- **Step days (צעדי אימון):** מרווח בין נקודות אימון (ברירת מחדל: 5 ימים)
- **Window:** אופן התרחבות חלון האימון
  - `expanding`: כל הנתונים עד כה
  - `rolling`: חלון קבוע (דורש הגדרת lookback)
- **Lookback:** מספר הימים לחלון rolling (פעיל רק ב-rolling mode)
- **Model:** בחירת אלגוריתם הלמידה
  - RandomForest: יציב ומהיר
  - LightGBM: מהיר ויעיל
  - CatBoost: מדויק אבל איטי
  - LogisticRegression: פשוט ומהיר
- **Single Stock:** הרצת פייפליין על מניה ספציפית אחת (אופציונלי)

#### בחירת תכונות (Features)
- **Technical Indicators:** אינדיקטורים טכניים (RSI, MACD, Bollinger Bands, EMA, SMA)
- **Volume Data:** נתוני נפח מסחר עם יחסים
- **Sentiment Data:** נתוני סנטימנט (אם זמינים)

#### התקדמות הפייפליין (Pipeline Progress)
- **Run Pipeline:** הפעלת תהליך האימון
- **Stop Pipeline:** עצירת התהליך
- **Progress Bar:** התקדמות כללית (0-100%)
- **Step Counter:** מונה שלבים מפורט (X/Y הושלם)
- **Progress Details:** לוג מפורט של כל שלב בתהליך

### 📈 Performance — ביצועים ותוצאות
**מטרה:** צפייה בתוצאות האימון והביצועים

**תכונות:**
- טבלת מדדי ביצועים (Metrics Table)
- לוג אימון מפורט
- צפייה בתחזיות (Predictions)
- ניתוח תוצאות לפי הורייזנים שונים

## תהליך העבודה המלא

### שלב 1: הכנת נתונים
1. עבור לטאב **Data**
2. בחר מקור נתונים (ברירת מחדל: IBKR)
3. בחר טווח תאריכים (ברירת מחדל: שנה)
4. הזן רשימת מניות או השאר ריק לכל המניות
5. לחץ **"Load Data"** - תראה התקדמות טעינת הקבצים

### שלב 2: הגדרת פרמטרי אימון
1. עבור לטאב **Pipeline**
2. התאם פרמטרים לפי הצורך:
   - השאר ברירות מחדל או שנה לפי ניסיון
   - בחר מודל (LightGBM מומלץ למתחילים)
   - סמן תכונות רצויות
3. אופציונלי: הזן מניה ספציפית בשדה "Single Stock"

### שלב 3: הרצת האימון
1. לחץ **"🏃 Run Pipeline"**
2. צפה בהתקדמות:
   - סרגל התקדמות כללי
   - מונה שלבים מפורט
   - לוג חי של כל פעולה
3. התהליך כולל:
   - טעינת נתונים (חד-פעמי)
   - בניית תכונות לכל הורייזן (1, 5, 10 ימים)
   - אימון מודל לכל הורייזן
   - בחירת ההורייזן הטוב ביותר
   - שמירת תחזיות וסטטיסטיקות

### שלב 4: ניתוח תוצאות
1. עבור לטאב **Performance**
2. צפה במדדי הביצועים
3. בדוק את הלוג המפורט
4. נתח את התחזיות שנשמרו

## לוגיקה טכנית מפורטת

### טעינת נתונים
- נטענים 10,958 קבצי Parquet
- כל קובץ מכיל נתוני OHLCV + נפח למניה אחת
- טווח זמן: 2020-01-02 עד 2025-10-03
- סינון ערכים חריגים ואינסופיים אוטומטי

### בניית תכונות (Feature Engineering)
- **טכניים:** EMA, SMA, RSI, MACD, ATR, Bollinger Bands
- **נפח:** ממוצעים נעים + יחסים בטוחים (ללא חילוק באפס)
- **סנטימנט:** אם זמינים בדאטה

### תהליך אימון (Walk-Forward Validation)
```
לכל הורייזן ∈ [1, 5, 10]:
  בנה תכונות
  חלק ל-train/test עם holdout
  אמן מודל עם fine-tuning
  חשב איכות (F1 score)
בחר הורייזן עם איכות מקסימלית
```

### מניעת בעיות נתונים
- **אינסופיים:** המרה ל-NaN + קליפינג ערכים קיצוניים
- **NaN:** סינון אוטומטי לפני concat
- **זיכרון:** טעינה הדרגתית עם progress callbacks

## טיפים לשימוש יעיל

### למתחילים:
- השאר ברירות מחדל
- התחל עם LightGBM
- סמן Technical + Volume
- הרץ על כל המניות (שדה Single Stock ריק)

### למתקדמים:
- נסה CatBoost למדויקות מקסימלית
- הוסף Sentiment אם יש נתונים
- שנה holdout/step לפי אסטרטגיה
- השתמש Single Stock לבדיקות מהירות

### לפתרון בעיות:
- אם התוכנה נתקעת: בדוק שיש זיכרון פנוי
- אם אין תוצאות: בדוק שיש נתונים בטאב Data
- אם איכות נמוכה: נסה מודל אחר או תכונות נוספות

## עדכונים אחרונים (אוקטובר 2025)

- ✅ הפרדה ל-3 טאבים נפרדים
- ✅ tooltips בעברית לכל השדות
- ✅ progress bar נפרד לטעינת נתונים
- ✅ תמיכה במניה בודדת
- ✅ ביטול חיבור אוטומטי ל-IBKR
- ✅ תיקון בעיות אינסופיים בנתונים
- ✅ שיפור לוגים ודיווחים
- ✅ ממשק responsive שלא נתקע
- ✅ אינטגרציה מלאה של Daily Update בטאב Data
- ✅ תת-טאבים נפרדים ל-Data Loading ו-Daily Update
- ✅ דוח סופי מובנה לאחר עדכון
- ✅ לוגים חיים בזמן אמת
- ✅ תזמון גמיש לעדכונים אוטומטיים

## דרישות מערכת

- **זיכרון:** מינימום 8GB RAM
- **דיסק:** 50GB פנוי לנתונים
- **זמן:** 10-30 דקות לאימון מלא
- **תלויות:** pandas, scikit-learn, lightgbm, catboost, pytorch-tabnet

---

*לקבלת עזרה נוספת, השתמש בלשונית AI Agent או פתח issue ב-GitHub.*
